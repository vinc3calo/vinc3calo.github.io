<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ESP Student Firmware Flasher</title>
<script type="module">
import "https://unpkg.com/esp-web-tools@9.3.0/dist/web/install-button.js";

document.addEventListener("DOMContentLoaded", () => {
  const modelSelect = document.getElementById("model");
  const groupSelect = document.getElementById("group");
  const sensorSelect = document.getElementById("sensor");
  const container = document.getElementById("install-container");
  const statusBox = document.getElementById("status");

  // Map each combination to its manifest URL pattern
  // The actual files should exist like:
  // manifests/ESP8266-group1-DHT11.json
  // manifests/ESP8266-group1-DHT22.json
  const manifestMap = {
    "ESP8266": {
      "1": { "DHT11": "manifests/ESP8266-group1-DHT11.json", "DHT22": "manifests/ESP8266-group1-DHT22.json" },
      "2": { "DHT11": "manifests/ESP8266-group2-DHT11.json", "DHT22": "manifests/ESP8266-group2-DHT22.json" },
      "3": { "DHT11": "manifests/ESP8266-group3-DHT11.json", "DHT22": "manifests/ESP8266-group3-DHT22.json" },
      "4": { "DHT11": "manifests/ESP8266-group4-DHT11.json", "DHT22": "manifests/ESP8266-group4-DHT22.json" },
      "5": { "DHT11": "manifests/ESP8266-group5-DHT11.json", "DHT22": "manifests/ESP8266-group5-DHT22.json" }
    },
    "ESP32": {
      "1": { "DHT11": "manifests/ESP32-group1-DHT11.json", "DHT22": "manifests/ESP32-group1-DHT22.json" },
      "2": { "DHT11": "manifests/ESP32-group2-DHT11.json", "DHT22": "manifests/ESP32-group2-DHT22.json" },
      "3": { "DHT11": "manifests/ESP32-group3-DHT11.json", "DHT22": "manifests/ESP32-group3-DHT22.json" },
      "4": { "DHT11": "manifests/ESP32-group4-DHT11.json", "DHT22": "manifests/ESP32-group4-DHT22.json" },
      "5": { "DHT11": "manifests/ESP32-group5-DHT11.json", "DHT22": "manifests/ESP32-group5-DHT22.json" }
    }
    // Add more models later (ESP32, etc.)
  };

  function createInstaller() {
    const model = modelSelect.value;
    const group = groupSelect.value;
    const sensor = sensorSelect.value;
    container.innerHTML = "";

    if (!model || !group || !sensor) {
      statusBox.textContent = "Please select model, group, and sensor.";
      return;
    }

    const manifestUrl = manifestMap[model]?.[group]?.[sensor];
    if (!manifestUrl) {
      statusBox.textContent = "Firmware not available for this selection.";
      return;
    }

    statusBox.textContent = `Ready to flash ${model} Group ${group} (${sensor})`;

    const installer = document.createElement("esp-web-install-button");
    installer.manifest = manifestUrl;
    installer.className = "installer";

    installer.addEventListener("update", (e) => {
      if (e.detail && e.detail.state) {
        statusBox.textContent = `Status: ${e.detail.state} | Device: ${model}-${group.padStart(3,"0")} (${sensor})`;
      }
    });

    container.appendChild(installer);
  }

  modelSelect.addEventListener("change", createInstaller);
  groupSelect.addEventListener("change", createInstaller);
  sensorSelect.addEventListener("change", createInstaller);
});
</script>

<style>
body { font-family: system-ui, sans-serif; background:#f7f9fc; text-align:center; padding:50px; }
h1 { color:#333; }
select { font-size:1rem; padding:0.5em 1em; margin:0.5em; border-radius:8px; border:1px solid #ccc; }
#install-container { margin-top:20px; }
esp-web-install-button::part(button) {
  background-color:#0078d7; color:white; border:none; border-radius:8px; padding:0.7em 1.2em; cursor:pointer; font-size:1rem;
}
esp-web-install-button::part(button):hover { background-color:#005fa3; }
#status { margin-top:20px; color:#333; font-weight:500; }
footer { margin-top:30px; color:#666; font-size:0.9rem; }
</style>
</head>
<body>
<h1>ESP Student Firmware Flasher</h1>
<p>Select your ESP model, group, and DHT sensor, then click “Connect & Install.”</p>

<select id="model">
  <option value="">-- Select Model --</option>
  <option value="ESP8266">ESP8266</option>
  <option value="ESP32">ESP32</option>
</select>

<select id="group">
  <option value="">-- Select Group --</option>
  <option value="1">Group 1</option>
  <option value="2">Group 2</option>
  <option value="3">Group 3</option>
  <option value="4">Group 4</option>
  <option value="5">Group 5</option>
</select>

<select id="sensor">
  <option value="">-- Select Sensor --</option>
  <option value="DHT11">DHT11</option>
  <option value="DHT22">DHT22</option>
</select>

<div id="install-container"></div>
<div id="status">Waiting for selection...</div>

<footer>Works in Chrome or Edge (desktop). Ensure your ESP is connected via USB.</footer>
</body>
</html>
